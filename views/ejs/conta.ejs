<body class="wrapper">
    <main class="wrapper_main">
        <!-- views/partials/navbar.ejs -->
        <%- include ("../partials/navbar") %>
        <!-- views/partials/msg.ejs -->
        <%- include ("../partials/msg") %>
        
        <div class="user">
            <h2>Informações da conta:</h2>
            <div class="usernameinfo">
                <h3>Usuário:</h3>
                <h3 id=username> <%=user.username%> </h3>
            </div>
            <div class="emailinfo">
                <h3>Email:</h3>
                <h3 id=useremail> <%=user.email%> </h3>
            </div>
            <div class="dateinfo">
                <h3>Data de criação:</h3>
                <h3 id=userdate> <%=user.createdAt%> </h3>
            </div>
            <button type="button" class="account_button">Mudar Senha</button>
            <button type="button" class="account_button">Deletar Conta</button>
            <div class="playlistinfo">
                <h3>Nº de Playlists:</h3>
                <h3 id=userplaylist>4</h3>
            </div>
            <div id = "playlist_list">
            </div>
        </div>
    </main>
    <script>
        async function encontrarPlaylistsUsuario() {
            try {
                console.log('<%= user.id%>')
                await fetch('http://localhost:8081/v1/playlists/<%= user.id%>')
                .then(response => {
                    response.json().then((data) => {
                        data.forEach(function selectplaylists(playlist) {
                            if(playlist.appname == 'spotify') {
                                displayPlaylistsSpotify(playlist.imageURL, playlist.totaltracks, playlist.owner, playlist.name, playlist.collaborative)
                            } else {
                                console.log("Outros aplicativos ainda não adicionados!") // Aqui entra um if else dos outros aplicativos
                            }
                        })
                    })
                })
            } catch (error) {
                console.log(error)
            }
            
        }

        encontrarPlaylistsUsuario()

        function displayPlaylistsSpotify(imageurl, tracksqnt, owner, name, collaborative) {
    
        var block = document.createElement('div');
        block.classList.add('playlist_block');
        block.innerHTML = "<img class=\"album_icon\" src=" + imageurl + " alt=\"Album Cover\">" 
        + "<div class=playlist_item>" + name + "</div>"
        + "<div class=playlist_item>Tracks: "+ tracksqnt +"</div>"
        + "<div class=playlist_item>" + owner +"</div>"
        + "<div class=playlist_item>Collab: "+ collaborative +"</div>"
        + "<button type=\"submit\" class=delete_btn><i class=\"fas fa-trash\"></i></button>"
    
        document.getElementById("playlist_list").insertBefore(block, document.getElementById("playlist_list").firstChild);
}
    </script>
</body>
